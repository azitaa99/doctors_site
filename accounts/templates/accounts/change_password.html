{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
  <h3>تغییر رمز عبور</h3>
  <form id="changePasswordForm">
    <div class="form-group">
      <label>رمز عبور فعلی</label>
      <input type="password" class="form-control" id="old_password" required>
    </div>
    <div class="form-group">
      <label>رمز عبور جدید</label>
      <input type="password" class="form-control" id="new_password" required>
    </div>
    <div class="form-group">
      <label>تأیید رمز عبور جدید</label>
      <input type="password" class="form-control" id="confirm_new_password" required>
    </div>
    <button type="submit" class="btn btn-primary mt-3">ثبت تغییرات</button>
    <p id="result-message" class="mt-3 text-success"></p>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const token = localStorage.getItem('auth_token');
    const oldPassword = document.getElementById('old_password').value;
    const newPassword = document.getElementById('new_password').value;
    const confirmNewPassword = document.getElementById('confirm_new_password').value;

    axios.post('http://localhost:8000/api/user-changepassword/', {
      old_password: oldPassword,
      new_password: newPassword,
      confirm_new_password: confirmNewPassword
    }, {
      headers: {
        Authorization: `Bearer ${token}`
      }
    })
    .then(response => {

      document.getElementById('result-message').innerText = response.data.message;

    })
    .catch(error => {
      const msg = error.response?.data?.detail || 'خطا در تغییر رمز عبور';
      document.getElementById('result-message').innerText = msg;
      document.getElementById('result-message').classList.remove('text-success');
      document.getElementById('result-message').classList.add('text-danger');
    });
  });
</script>
{% endblock %}
